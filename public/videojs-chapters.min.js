/*! @name @viostream/videojs-chapters @version v0.0.17 @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js"),require("global/window")):"function"==typeof define&&define.amd?define(["video.js","global/window"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).videojsChapters=t(e.videojs,e.window)}(this,(function(e,t){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=r(e),n=r(t);function o(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var i=o((function(e){function t(r,a){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,t(r,a)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0})),s=o((function(e){e.exports=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t)},e.exports.default=e.exports,e.exports.__esModule=!0})),c=function(e){var t=n.default.document.createElement("div");t.className="vjs-viostream-chapters-icon",t.setAttribute("title","Chapters"),t.setAttribute("aria-label","Chapters"),e.appendChild(t)},l=function(e,t){var r=t.join(" "),a=e+"-styles";if(r){var o=n.default.document.querySelector("#"+a);null!==o&&o.parentNode.removeChild(o),null===o&&((o=n.default.document.createElement("style")).setAttribute("type","text/css"),o.id=a),o.append(n.default.document.createTextNode(r)),n.default.document.head.append(o)}},d=function(e,t,r){return"#"+e+" "+t+" { "+r+" }"},p=function(e){function t(r,a){var n;n=e.call(this,r,a)||this;var o=r.el();n.cssRules=[],n.settings={skin:{background:"#1a1a1a",color:"#ffffff"}},a.styles&&(n.settings.skin=a.styles),n.containerId=r.id()+"-vjs-viostream-chaptering-container",n.generateStyles();var i=document.createElement("div");i.id=n.containerId,i.className="vjs-viostream-chaptering-container vjs-viostream-chaptering-container-dropdown",i.setAttribute("data-chapter-mode","dropdown"),c(i);var s=document.createElement("select");s.className="vjs-viostream-chaptering-dropdown",s.onchange=null,i.appendChild(s),o.parentNode.insertBefore(i,o.nextSibling);var l=[];void 0===a.chapters&&(a.chapters=[]);for(var d=r.duration(),p=0;p<a.chapters.length;p++)if(!(a.chapters[p].time<0||a.chapters[p].time>d)){l.push(a.chapters[p].time);var u=document.createElement("option");u.value=a.chapters[p].time,u.text=a.chapters[p].label,s.appendChild(u)}return s.selectedIndex=0,s.onchange=function(e){t.changeEventHandler(r,e)},t.onChapterProgressForDropdown(r,s,l),n}return s(t,e),t.prototype.generateStyles=function(){var e=[d(this.containerId,"","background-color:"+this.settings.skin.background),d(this.containerId,"","color:"+this.settings.skin.color)];l(this.containerId,e)},t.changeEventHandler=function(e,t){var r=t.target.value;e.currentTime(r),e.play()},t.onChapterProgressForDropdown=function(e,t,r){e.on("timeupdate",(function(e){var a=this.currentTime();if(!(0===r.length||a<r[0]))for(var n=r.length;n>0;n--)if(a>=r[n-1]){t.selectedIndex!==n-1&&(t.selectedIndex=n-1);break}}))},t}(videojs.getComponent("Component"));videojs.registerComponent("ChapterDropdownControl",p);var u=function(e){function t(r,a){var n;n=e.call(this,r,a)||this;var o=r.el();n.settings={skin:{background:"#1a1a1a",color:"#fff",backgroundActive:"#272727",colorActive:"#fff"}},a.styles&&(n.settings.skin=a.styles),n.containerId=r.id()+"-vjs-viostream-chaptering-container",n.generateStyles();var i=document.createElement("div");i.id=n.containerId,i.className="vjs-viostream-chaptering-container v-hide vjs-viostream-chaptering-horizontal",i.setAttribute("data-chapter-mode","horizontal"),c(i);var s=document.createElement("div");s.className="vjs-viostream-outer-stage";var l=document.createElement("div");l.className="vjs-viostream-chapter-item-list";var d=document.createElement("button");d.className="vjs-viostream-chaptering-arrow-button vjs-viostream-chaptering-left",d.title="Show earlier chapters";var p=document.createElement("i");p.className="vjs-viostream-chaptering-arrow-button-left-sign vjs-viostream-chaptering-arrow-button-icon";var u=document.createElement("button");u.className="vjs-viostream-chaptering-arrow-button vjs-viostream-chaptering-right",u.title="Show later chapters";var h=document.createElement("i");return h.className="vjs-viostream-chaptering-arrow-button-right-sign vjs-viostream-chaptering-arrow-button-icon",d.onclick=function(){return d.focus(),t.scrollLeft(l),!1},u.onclick=function(){return u.focus(),t.scrollRight(l),!1},d.appendChild(p),i.appendChild(d),u.appendChild(h),i.appendChild(u),s.appendChild(l),i.appendChild(s),o.parentNode.insertBefore(i,o.nextSibling),void 0===a.chapters&&(a.chapters=[]),r.ready((function(){t.addChapters(r,a.chapters),t.resize(i)})),n}return s(t,e),t.prototype.generateStyles=function(){var e=this.settings.skin,t=[d(this.containerId,"","background-color:"+this.settings.skin.background+"; color:"+this.settings.skin.color),d(this.containerId,".vjs-viostream-chaptering-arrow-button","background-color:"+e.background),d(this.containerId,".vjs-viostream-chaptering-arrow-button-icon","border-color:"+e.color),d(this.containerId,".vjs-viostream-chaptering-arrow-button-icon:hover","border-color:"+e.colorActive),d(this.containerId,".vjs-viostream-chapter-item","background-color:"+e.background+";color:"+e.color),d(this.containerId,".vjs-viostream-chapter-item:hover","background-color:"+e.backgroundActive+";color:"+e.colorActive),d(this.containerId,".vjs-viostream-chapter-item:active, .vjs-viostream-chapter-item:focus","outline-color:"+e.colorActive+";"),d(this.containerId,".vjs-viostream-chapter-item.vjs-viostream-chapter-item-active","background-color:"+e.backgroundActive+";color:"+e.colorActive)];l(this.containerId,t)},t.minChapterItemWidth=function(){return 220},t.addChapters=function(e,r){var a=e.id()+"-vjs-viostream-chaptering-container",n=document.querySelector("#"+a);if(null!==n){var o=[],i=n.querySelector(".vjs-viostream-chapter-item-list");if(null!==r){var s=e.currentWidth(),c=Math.floor(s/t.minChapterItemWidth());c<1&&(c=1),i.style.left="0px",i.setAttribute("data-chapter-item-display",c),i.setAttribute("data-chapter-length",r.length),i.setAttribute("data-chapter-selected",0),i.setAttribute("data-chapter-step-index",0),i.setAttribute("data-chapter-scroll-index",0),i.setAttribute("data-chapter-max-scroll-index",r.length-c),i.innerHTML="";for(var l=e.duration(),d=0;d<r.length;d++)if(!(r[d].time<0||r[d].time>l)){o.push(r[d].time);var p=r[d].label.replace(/\"/gi,"&quot;"),u=document.createElement("button");u.className="vjs-viostream-chapter-item",u.setAttribute("data-time",r[d].time),u.setAttribute("data-chapter-index",d+1),u.setAttribute("aria-label",p);var h=document.createElement("span");h.innerHTML=r[d].label,u.appendChild(h),u.onclick=function(r){return t.selectChapterEvent(e,r,i),!1},i.appendChild(u)}r.length>0&&t.onChapterProgressForHorizontal(e,i,o),t.removeClass(n,"v-hide")}else t.addClass(n,"v-hide")}},t.onChapterProgressForHorizontal=function(e,r,a){e.on("timeupdate",(function(e){var n=this.currentTime();if(n<a[0])r.setAttribute("data-chapter-selected",0);else{var o=a.filter((function(e){return e<=n}));if(o.length>0){var i=o[o.length-1],s=a.indexOf(i)+1,c=parseInt(r.getAttribute("data-chapter-selected"),10);if(c>1){var l=parseInt(r.getAttribute("data-chapter-scroll-index"),10),d=l===parseInt(r.getAttribute("data-chapter-max-scroll-index"),10)?l:l+1;r.setAttribute("data-chapter-scroll-index",d)}else r.setAttribute("data-chapter-scroll-index",0);if(s!==c){r.setAttribute("data-chapter-selected",s),t.clearSelectedStyle(r);var p=r.querySelectorAll(".vjs-viostream-chapter-item")[s-1];t.addClass(p,"vjs-viostream-chapter-item-active"),t.scrollChapterItemList(p,r)}}}}))},t.scrollChapterItemList=function(e,r){if(null!==e&&!t.hasClass(r.parentNode.parentNode,"vjs-viostream-chaptering-noscroll")){var a=parseInt(e.getAttribute("data-chapter-index"),10)-1,n=e.clientWidth*-a,o=e.clientWidth,i=parseInt(r.getAttribute("data-chapter-item-display"),10),s=-(parseInt(r.clientWidth,10)-o*i);r.setAttribute("data-chapter-step-index",a),r.scrollLeft=0,r.parentNode.scrollLeft=0,r.style.left=Math.max(n,s)+"px"}},t.selectChapterEvent=function(e,t,r){var a=t.target;"SPAN"===t.target.tagName&&(a=t.target.parentElement);var n=a.getAttribute("data-time");e.currentTime(n),e.play()},t.scrollLeft=function(e){var t=parseInt(e.getAttribute("data-chapter-scroll-index"),10),r=0===t?0:t-1;e.setAttribute("data-chapter-scroll-index",r);var a=parseInt(e.style.left,10)+parseInt(e.getAttribute("data-chapter-item-width"),10);e.style.left=Math.min(a,0)+"px"},t.scrollRight=function(e){var t=parseInt(e.getAttribute("data-chapter-item-width"),10),r=parseInt(e.getAttribute("data-chapter-item-display"),10),a=parseInt(e.style.left,10)-t,n=-(e.clientWidth-t*r),o=parseInt(e.getAttribute("data-chapter-scroll-index"),10),i=o===parseInt(e.getAttribute("data-chapter-max-scroll-index"),10)?o:o+1;e.setAttribute("data-chapter-scroll-index",i),e.style.left=Math.max(a,n)+"px"},t.clearSelectedStyle=function(e){for(var r=e.querySelectorAll(".vjs-viostream-chapter-item"),a=0;a<r.length;a++)t.removeClass(r[a],"vjs-viostream-chapter-item-active")},t.resize=function(e,r){var a=e.querySelector(".vjs-viostream-chapter-item-list");a.style.width=null;var n=a.parentNode.offsetWidth,o=Math.floor(e.clientWidth/t.minChapterItemWidth());0===o&&(o=1),a.setAttribute("data-chapter-item-display",o);var i=Math.floor(n/o);a.setAttribute("data-chapter-item-width",i);var s=a.childNodes.length,c=s*i,l=!1;if(c<=n?(l=!1,a.style.left="0",t.addClass(e,"vjs-viostream-chaptering-noscroll")):(l=!0,t.removeClass(e,"vjs-viostream-chaptering-noscroll")),l){for(var d=0;d<s;d++)a.childNodes[d].style.width=i+"px";a.style.width=c+"px",window.setTimeout((function(){t.scrollChapterItemList(e.querySelector(".vjs-viostream-chapter-item-active"),a)}),300)}else for(var p=0;p<s;p++)a.childNodes[p].style.width=100/s+"%"},t.addClass=function(e,t){e.className.indexOf(t)>-1||(e.className=(e.className+" "+t).trim())},t.removeClass=function(e,t){-1!==e.className.indexOf(t)&&(e.className=e.className.replace(t,"").replace(/\s+/g," "))},t.addStyle=function(e,t){if(e){var r=document.getElementById(t);null===r&&((r=document.createElement("style")).setAttribute("type","text/css"),r.id=t),r.appendChild(document.createTextNode(e)),document.head.appendChild(r)}},t.removeStyleElement=function(e){var t=document.getElementById(e);null!==t&&t.parentNode.removeChild(t)},t.hasClass=function(e,t){return-1!==e.className.indexOf(t)},t}(videojs.getComponent("Component"));videojs.registerComponent("ChapterHorizontalControl",u);var h=function(e){function t(r,a){var n;return n=e.call(this,r,a)||this,void 0===a.chapters&&(a.chapters=[]),r.ready((function(){t.addMarkers(a.chapters,r)})),n}return s(t,e),t.addMarkers=function(e,t){for(var r=t.duration(),a=e.length,n=t.el().getElementsByClassName("vjs-progress-holder")[0],o=0;o<a;o++)if(!(e[o].time<0||e[o].time>r)){var i=document.createElement("div");i.className="vjs-viostream-marker",i.id="cp"+o;var s=e[o].time/r*100;i.style.left=s+"%";var c=document.createElement("span");c.className="tooltiptext",c.innerHTML=e[o].label,i.appendChild(c),n.appendChild(i)}},t}(videojs.getComponent("Component"));videojs.registerComponent("ChapterMarkersProgressBarControl",h);var v=a.default.getPlugin("plugin"),m={},f=function(e){function t(t,r){var n;return(n=e.call(this,t)||this).options=a.default.mergeOptions(m,r),n.player.ready((function(){n.player.addClass("vjs-captions-menu")})),n.player.one("loadedmetadata",(function(){if(void 0!==r.chapterType&&void 0!==r.chapters&&!(r.chapters.length<1))switch(r.chapterType.toLowerCase()){case"dropdown":t.chapterDropdownControl=new p(t,r);break;case"native":case"progressbar":t.chapterMarkersProgressBarControl=new h(t,r);break;case"classic":case"classicsmall":case"horizontal":default:t.ChapterHorizontalControl=new u(t,r)}})),n}return s(t,e),t}(v);return f.defaultState={},f.VERSION="v0.0.17",a.default.registerPlugin("chapters",f),f}));
